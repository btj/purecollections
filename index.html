<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>purecollections by btj</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>purecollections</h1>
        <p>Purely functional data structures for Java</p>

        <p class="view"><a href="https://github.com/btj/purecollections">View the Project on GitHub <small>btj/purecollections</small></a></p>


        <ul>
          <li><a href="https://github.com/btj/purecollections/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/btj/purecollections/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/btj/purecollections">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <p>Java's standard collection classes in the java.util package are mutable. As a result, passing instances of these classes between modules requires special care, such as making copies or wrapping them in unmodifiable wrappers, to avoid inadvertent modifications of a module's internal state representation by other modules, a problem known as <strong>representation exposure</strong>.</p>

<p>For example, consider a Person class that maintains a map of children and a list of telephone numbers. We show two variants of each getter: one which returns an unmodifiable wrapper, and one which creates a copy. Note that the public constructor that accepts initial values for the children and the phone numbers needs to defensively create a copy of the incoming collections.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">import</span> <span class="pl-smi">java.util.ArrayList</span>;
<span class="pl-k">import</span> <span class="pl-smi">java.util.Collections</span>;
<span class="pl-k">import</span> <span class="pl-smi">java.util.HashMap</span>;
<span class="pl-k">import</span> <span class="pl-smi">java.util.List</span>;
<span class="pl-k">import</span> <span class="pl-smi">java.util.Map</span>;

<span class="pl-k">class</span> <span class="pl-en">Person</span> {

    <span class="pl-k">private</span> <span class="pl-k">final</span> <span class="pl-k">Map&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Person</span>&gt;</span> children;
    <span class="pl-k">private</span> <span class="pl-k">final</span> <span class="pl-k">Map&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Person</span>&gt;</span> childrenUnmodifiableWrapper;
    <span class="pl-k">private</span> <span class="pl-k">final</span> <span class="pl-k">List&lt;<span class="pl-smi">String</span>&gt;</span> phoneNumbers;
    <span class="pl-k">private</span> <span class="pl-k">final</span> <span class="pl-k">List&lt;<span class="pl-smi">String</span>&gt;</span> phoneNumbersUnmodifiableWrapper;

    <span class="pl-k">private</span> <span class="pl-en">Person</span>(<span class="pl-k">Map&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Person</span>&gt;</span> <span class="pl-v">children</span>, <span class="pl-k">List&lt;<span class="pl-smi">String</span>&gt;</span> <span class="pl-v">phoneNumbers</span>, <span class="pl-k">boolean</span> <span class="pl-v">dummy</span>) {
        <span class="pl-v">this</span><span class="pl-k">.</span>children <span class="pl-k">=</span> children;
        <span class="pl-v">this</span><span class="pl-k">.</span>childrenUnmodifiableWrapper <span class="pl-k">=</span> <span class="pl-smi">Collections</span><span class="pl-k">.</span>unmodifiableMap(<span class="pl-v">this</span><span class="pl-k">.</span>children);
        <span class="pl-v">this</span><span class="pl-k">.</span>phoneNumbers <span class="pl-k">=</span> phoneNumbers;
        <span class="pl-v">this</span><span class="pl-k">.</span>phoneNumbersUnmodifiableWrapper <span class="pl-k">=</span> <span class="pl-smi">Collections</span><span class="pl-k">.</span>unmodifiableList(<span class="pl-v">this</span><span class="pl-k">.</span>phoneNumbers);
    }

    <span class="pl-k">public</span> <span class="pl-en">Person</span>(<span class="pl-k">Map&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Person</span>&gt;</span> <span class="pl-v">children</span>, <span class="pl-k">List&lt;<span class="pl-smi">String</span>&gt;</span> <span class="pl-v">phoneNumbers</span>) {
        <span class="pl-c">// Create defensive copies</span>
        <span class="pl-v">this</span>(<span class="pl-k">new</span> <span class="pl-k">HashMap&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Person</span>&gt;</span>(children), <span class="pl-k">new</span> <span class="pl-k">ArrayList&lt;<span class="pl-smi">String</span>&gt;</span>(phoneNumbers), <span class="pl-c1">false</span>);
    }

    <span class="pl-k">public</span> <span class="pl-en">Person</span>() {
        <span class="pl-v">this</span>(<span class="pl-k">new</span> <span class="pl-k">HashMap&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Person</span>&gt;</span>(), <span class="pl-k">new</span> <span class="pl-k">ArrayList&lt;<span class="pl-smi">String</span>&gt;</span>(), <span class="pl-c1">false</span>);
    }

    <span class="pl-k">public</span> <span class="pl-k">Map&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Person</span>&gt;</span> <span class="pl-en">getChildren1</span>() {
        <span class="pl-k">return</span> childrenUnmodifiableWrapper;
    }

    <span class="pl-k">public</span> <span class="pl-k">Map&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Person</span>&gt;</span> <span class="pl-en">getChildren2</span>() {
        <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-k">HashMap&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Person</span>&gt;</span>(children);
    }

    <span class="pl-k">public</span> <span class="pl-smi">Person</span> <span class="pl-en">addChild</span>(<span class="pl-smi">String</span> <span class="pl-v">name</span>) {
        <span class="pl-smi">Person</span> child <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Person</span>();
        children<span class="pl-k">.</span>put(name, child);
        <span class="pl-k">return</span> child;
    }

    <span class="pl-k">public</span> <span class="pl-k">List&lt;<span class="pl-smi">String</span>&gt;</span> <span class="pl-en">getPhoneNumbers1</span>() {
        <span class="pl-k">return</span> phoneNumbersUnmodifiableWrapper;
    }

    <span class="pl-k">public</span> <span class="pl-k">List&lt;<span class="pl-smi">String</span>&gt;</span> <span class="pl-en">getPhoneNumbers2</span>() {
        <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-k">ArrayList&lt;<span class="pl-smi">String</span>&gt;</span>(phoneNumbers);
    }

    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">addPhoneNumber</span>(<span class="pl-smi">String</span> <span class="pl-v">phoneNumber</span>) {
        phoneNumbers<span class="pl-k">.</span>add(phoneNumber);
    }

}</pre></div>

<p>This project offers a simpler solution to the representation exposure problem. It provides a small library of <strong>purely functional</strong> data structures: a purely functional list data structure called PList, and a purely functional map data structure called PMap. Using purely functional data structures, which are inherently immutable, eliminates the representation exposure problem without wrapping or copying.</p>

<p>We can simplify the example using the purely functional PMap and PList data structures as follows. Note that no copying or wrapping is necessary, either for incoming or for outgoing collections. Since PMap and PList are classes that have no public or protected constructors, there can be no instances of these types that accidentally or maliciously exhibit mutable or otherwise incorrect behavior.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">import</span> <span class="pl-smi">purecollections.PMap</span>;
<span class="pl-k">import</span> <span class="pl-smi">purecollections.PList</span>;

<span class="pl-k">class</span> <span class="pl-en">Person</span> {

    <span class="pl-k">private</span> <span class="pl-k">PMap&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Person</span>&gt;</span> children;
    <span class="pl-k">private</span> <span class="pl-k">PList&lt;<span class="pl-smi">String</span>&gt;</span> phoneNumbers;

    <span class="pl-k">public</span> <span class="pl-en">Person</span>(<span class="pl-k">PMap&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Person</span>&gt;</span> <span class="pl-v">children</span>, <span class="pl-k">PList&lt;<span class="pl-smi">String</span>&gt;</span> <span class="pl-v">phoneNumbers</span>) {
        <span class="pl-v">this</span><span class="pl-k">.</span>children <span class="pl-k">=</span> children;
        <span class="pl-v">this</span><span class="pl-k">.</span>phoneNumbers <span class="pl-k">=</span> phoneNumbers;
    }

    <span class="pl-k">public</span> <span class="pl-en">Person</span>() {
        <span class="pl-v">this</span>(<span class="pl-smi">PMap</span><span class="pl-k">.</span><span class="pl-k">&lt;</span><span class="pl-smi">String</span>, <span class="pl-smi">Person</span><span class="pl-k">&gt;</span>empty(), <span class="pl-smi">PList</span><span class="pl-k">.</span><span class="pl-k">&lt;</span><span class="pl-smi">String</span><span class="pl-k">&gt;</span>empty());
    }

    <span class="pl-k">public</span> <span class="pl-k">PMap&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Person</span>&gt;</span> <span class="pl-en">getChildren</span>() {
        <span class="pl-k">return</span> children;
    }

    <span class="pl-k">public</span> <span class="pl-smi">Person</span> <span class="pl-en">addChild</span>(<span class="pl-smi">String</span> <span class="pl-v">name</span>) {
        <span class="pl-smi">Person</span> child <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Person</span>();
        children <span class="pl-k">=</span> children<span class="pl-k">.</span>plus(name, child);
        <span class="pl-k">return</span> child;
    }

    <span class="pl-k">public</span> <span class="pl-k">PList&lt;<span class="pl-smi">String</span>&gt;</span> <span class="pl-en">getPhoneNumbers</span>() {
        <span class="pl-k">return</span> phoneNumbers;
    }

    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">addPhoneNumber</span>(<span class="pl-smi">String</span> <span class="pl-v">phoneNumber</span>) {
        phoneNumbers <span class="pl-k">=</span> phoneNumbers<span class="pl-k">.</span>plus(phoneNumber);
    }

}</pre></div>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/btj">btj</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
