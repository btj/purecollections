{"name":"purecollections","tagline":"Purely functional data structures for Java","body":"Java's standard collection classes in the java.util package are mutable. As a result, passing instances of these classes between modules requires special care, such as making copies or wrapping them in unmodifiable wrappers, to avoid inadvertent modifications of a module's internal state representation by other modules, a problem known as **representation exposure**.\r\n\r\nFor example, consider a Person class that maintains a map of children and a list of telephone numbers. We show two variants of each getter: one which returns an unmodifiable wrapper, and one which creates a copy. Note that the public constructor that accepts initial values for the children and the phone numbers needs to defensively create a copy of the incoming collections.\r\n\r\n```\r\nimport java.util.ArrayList;\r\nimport java.util.Collections;\r\nimport java.util.HashMap;\r\nimport java.util.List;\r\nimport java.util.Map;\r\n\r\nclass Person {\r\n    \r\n    private final Map<String, Person> children;\r\n    private final Map<String, Person> childrenUnmodifiableWrapper;\r\n    private final List<String> phoneNumbers;\r\n    private final List<String> phoneNumbersUnmodifiableWrapper;\r\n    \r\n    private Person(Map<String, Person> children, List<String> phoneNumbers, boolean dummy) {\r\n    \tthis.children = children;\r\n    \tthis.childrenUnmodifiableWrapper = Collections.unmodifiableMap(this.children);\r\n    \tthis.phoneNumbers = phoneNumbers;\r\n    \tthis.phoneNumbersUnmodifiableWrapper = Collections.unmodifiableList(this.phoneNumbers);\r\n    }\r\n    \r\n    public Person(Map<String, Person> children, List<String> phoneNumbers) {\r\n    \t// Create defensive copies\r\n    \tthis(new HashMap<String, Person>(children), new ArrayList<String>(phoneNumbers), false);\r\n    }\r\n    \r\n    public Person() {\r\n    \tthis(new HashMap<String, Person>(), new ArrayList<String>(), false);\r\n    }\r\n        \r\n    public Map<String, Person> getChildren1() {\r\n        return childrenUnmodifiableWrapper;\r\n    }\r\n    \r\n    public Map<String, Person> getChildren2() {\r\n        return new HashMap<String, Person>(children);\r\n    }\r\n    \r\n    public Person addChild(String name) {\r\n        Person child = new Person();\r\n        children.put(name, child);\r\n        return child;\r\n    }\r\n    \r\n    public List<String> getPhoneNumbers1() {\r\n        return phoneNumbersUnmodifiableWrapper;\r\n    }\r\n    \r\n    public List<String> getPhoneNumbers2() {\r\n        return new ArrayList<String>(phoneNumbers);\r\n    }\r\n    \r\n    public void addPhoneNumber(String phoneNumber) {\r\n        phoneNumbers.add(phoneNumber);\r\n    }\r\n    \r\n}\r\n```\r\n\r\nThis project offers a simpler solution to the representation exposure problem. It provides a small library of **purely functional** data structures: a purely functional list data structure called PList, and a purely functional map data structure called PMap. Using purely functional data structures, which are inherently immutable, eliminates the representation exposure problem without wrapping or copying.\r\n\r\nWe can simplify the example using the purely functional PMap and PList data structures as follows. Note that no copying or wrapping is necessary, either for incoming or for outgoing collections. Since PMap and PList are classes that have no public or protected constructors, there can be no instances of these types that accidentally or maliciously exhibit mutable or otherwise incorrect behavior.\r\n\r\n```\r\nimport purecollections.PMap;\r\nimport purecollections.PList;\r\n\r\nclass Person {\r\n    \r\n    private PMap<String, Person> children;\r\n    private PList<String> phoneNumbers;\r\n    \r\n    public Person(PMap<String, Person> children, PList<String> phoneNumbers) {\r\n    \tthis.children = children;\r\n    \tthis.phoneNumbers = phoneNumbers;\r\n    }\r\n    \r\n    public Person() {\r\n    \tthis(PMap.<String, Person>empty(), PList.<String>empty());\r\n    }\r\n    \r\n    public PMap<String, Person> getChildren() {\r\n        return children;\r\n    }\r\n    \r\n    public Person addChild(String name) {\r\n        Person child = new Person();\r\n        children = children.plus(name, child);\r\n        return child;\r\n    }\r\n    \r\n    public PList<String> getPhoneNumbers() {\r\n        return phoneNumbers;\r\n    }\r\n    \r\n    public void addPhoneNumber(String phoneNumber) {\r\n        phoneNumbers = phoneNumbers.plus(phoneNumber);\r\n    }\r\n    \r\n}\r\n```\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}